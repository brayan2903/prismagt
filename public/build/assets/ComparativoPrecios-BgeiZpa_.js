import{_ as q}from"./AuthenticatedLayout-C8QzwPr4.js";import{k as G,l as I,g as M,a,F,L as J,z as K,i as O,o as C,w as r,b as o,c as h,f as $,d as v,t as _,n as X,K as z}from"./app-CUzzJzvG.js";import{_ as Z}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as Q,a as Y}from"./index-DrJCI-yG.js";import{S as ee,a as te,_ as oe}from"./index-B4H4SmOJ.js";import{B as ae}from"./index-C4heLS1I.js";import{_ as ne}from"./index-DrADcKwG.js";import{g as le,m as se,k as re,_ as T,l as ie,r as de,n as ue,w as pe,i as ce,q as ge,u as me,h as ve,e as N,v as fe,x as _e,T as be,y as xe,j as L,z as ye,b as R}from"./index-BFnYM-_t.js";import{T as Ce,a as E}from"./index-ssuluYC1.js";import"./CheckOutlined-CYvA00d6.js";import"./CloseCircleFilled-qUmIxp_J.js";import"./CheckCircleFilled-Px0g76Ph.js";const we=n=>{const{componentCls:t,popoverBg:p,popoverColor:l,width:g,fontWeightStrong:x,popoverPadding:c,boxShadowSecondary:i,colorTextHeading:k,borderRadiusLG:P,zIndexPopup:y,marginXS:b,colorBgElevated:d}=n;return[{[t]:T(T({},de(n)),{position:"absolute",top:0,left:{_skip_check_:!0,value:0},zIndex:y,fontWeight:"normal",whiteSpace:"normal",textAlign:"start",cursor:"auto",userSelect:"text","--antd-arrow-background-color":d,"&-rtl":{direction:"rtl"},"&-hidden":{display:"none"},[`${t}-content`]:{position:"relative"},[`${t}-inner`]:{backgroundColor:p,backgroundClip:"padding-box",borderRadius:P,boxShadow:i,padding:c},[`${t}-title`]:{minWidth:g,marginBottom:b,color:k,fontWeight:x},[`${t}-inner-content`]:{color:l}})},ie(n,{colorBg:"var(--antd-arrow-background-color)"}),{[`${t}-pure`]:{position:"relative",maxWidth:"none",[`${t}-content`]:{display:"inline-block"}}}]},ke=n=>{const{componentCls:t}=n;return{[t]:ue.map(p=>{const l=n[`${p}-6`];return{[`&${t}-${p}`]:{"--antd-arrow-background-color":l,[`${t}-inner`]:{backgroundColor:l},[`${t}-arrow`]:{background:"transparent"}}}})}},Pe=n=>{const{componentCls:t,lineWidth:p,lineType:l,colorSplit:g,paddingSM:x,controlHeight:c,fontSize:i,lineHeight:k,padding:P}=n,y=c-Math.round(i*k),b=y/2,d=y/2-p,f=P;return{[t]:{[`${t}-inner`]:{padding:0},[`${t}-title`]:{margin:0,padding:`${b}px ${f}px ${d}px`,borderBottom:`${p}px ${l} ${g}`},[`${t}-inner-content`]:{padding:`${x}px ${f}px`}}}},Se=le("Popover",n=>{const{colorBgElevated:t,colorText:p,wireframe:l}=n,g=se(n,{popoverBg:t,popoverColor:p,popoverPadding:12});return[we(g),ke(g),l&&Pe(g),re(g,"zoom-big")]},n=>{let{zIndexPopupBase:t}=n;return{zIndexPopup:t+30,width:177}}),he=()=>T(T({},ye()),{content:R(),title:R()}),$e=G({compatConfig:{MODE:3},name:"APopover",inheritAttrs:!1,props:ce(he(),T(T({},xe()),{trigger:"hover",placement:"top",mouseEnterDelay:.1,mouseLeaveDelay:.1})),setup(n,t){let{expose:p,slots:l,attrs:g}=t;const x=I();ge(n.visible===void 0),p({getPopupDomNode:()=>{var d,f;return(f=(d=x.value)===null||d===void 0?void 0:d.getPopupDomNode)===null||f===void 0?void 0:f.call(d)}});const{prefixCls:c,configProvider:i}=me("popover",n),[k,P]=Se(c),y=M(()=>i.getPrefixCls()),b=()=>{var d,f;const{title:S=L((d=l.title)===null||d===void 0?void 0:d.call(l)),content:s=L((f=l.content)===null||f===void 0?void 0:f.call(l))}=n,e=!!(Array.isArray(S)?S.length:S),w=!!(Array.isArray(s)?s.length:S);return!e&&!w?null:a(F,null,[e&&a("div",{class:`${c.value}-title`},[S]),a("div",{class:`${c.value}-inner-content`},[s])])};return()=>{const d=ve(n.overlayClassName,P.value);return k(a(be,N(N(N({},_e(n,["title","content"])),g),{},{prefixCls:c.value,ref:x,overlayClassName:d,transitionName:fe(y.value,"zoom-big",n.transitionName),"data-popover-inject":!0}),{title:b,default:l.default}))}}}),Ie=pe($e),Te={class:"flex justify-between items-center"},Ae={class:"p-6 bg-white shadow rounded-lg m-4"},Be={class:"bg-gray-50 p-4 rounded-lg border border-gray-200 mb-6"},De={key:0,class:"mb-4"},ze={class:"font-bold text-gray-800"},Ne={class:"text-xs text-gray-400"},Ee={key:1,class:"text-center"},Ue={class:"text-lg font-bold text-blue-600"},Oe={key:2,class:"text-center"},Le={class:"w-72 space-y-2"},Re={class:"bg-blue-50 p-2 rounded"},Me={class:"m-0"},Fe={class:"m-0"},We={class:"bg-orange-50 p-2 rounded"},je={class:"m-0"},He={class:"m-0"},Ve={key:3,class:"text-center"},qe={key:4,class:"text-right font-semibold"},Ge={key:2,class:"text-center py-20 bg-gray-50 rounded border-2 border-dashed border-gray-100"},Je={__name:"ComparativoPrecios",setup(n){const t=I(!1),p=I(!1),l=I([]),g=I([]),x=I([]),c=I(""),i=J({prd_id:void 0,tipo:"vend",anio:"2025",mes:"12"}),k=[{value:"01",label:"Enero"},{value:"02",label:"Febrero"},{value:"03",label:"Marzo"},{value:"04",label:"Abril"},{value:"05",label:"Mayo"},{value:"06",label:"Junio"},{value:"07",label:"Julio"},{value:"08",label:"Agosto"},{value:"09",label:"Septiembre"},{value:"10",label:"Octubre"},{value:"11",label:"Noviembre"},{value:"12",label:"Diciembre"}],P=[{title:"Empresa / Cliente",dataIndex:"rs",key:"rs"},{title:"Uso Real (Cant)",dataIndex:"cant_real",key:"cant_real",width:130,align:"center"},{title:"Pagó Fact (USD)",dataIndex:"pago_factura_me",key:"pago_factura_me",width:150,align:"right"},{title:"Análisis Catálogo",dataIndex:"info",key:"info",width:150,align:"center"},{title:"Estado",dataIndex:"status",key:"status",width:120,align:"center"}],y=M(()=>{if(!c.value)return l.value;const s=c.value.toLowerCase();return l.value.filter(e=>e.rs.toLowerCase().includes(s)||e.ruc.includes(s))}),b=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(s),d=(s,e)=>e.label.toLowerCase().indexOf(s.toLowerCase())>=0,f=async()=>{try{const[s,e]=await Promise.all([z.get("/api/lista-productos"),z.get("/api/lista-tipos")]);g.value=s.data.map(w=>({value:w.Prd_Id,label:`${w.Codigo} - ${w.Nombre}`})),x.value=e.data}catch(s){console.error("Error al cargar filtros iniciales",s)}},S=async()=>{if(!i.prd_id)return E.warning("Debe seleccionar un producto");t.value=!0,p.value=!0,l.value=[],c.value="";try{const s=await z.get("/api/comparativo-precios",{params:i});l.value=s.data,s.data.length===0&&E.info("No se hallaron registros")}catch{E.error("Error al procesar la auditoría")}finally{t.value=!1}};return K(()=>{f()}),(s,e)=>{const w=Ce,B=ee,A=Y,D=te,U=ae,W=Q,j=ne,H=Ie,V=oe;return C(),O(q,null,{header:r(()=>[o("div",Te,[e[6]||(e[6]=o("h1",{class:"text-xl font-bold text-gray-800"},"Auditoría de Membresías (Catálogo vs Realidad)",-1)),a(w,{color:"blue"},{default:r(()=>e[5]||(e[5]=[v("Valores en Dólares (USD)")])),_:1})])]),default:r(()=>[o("div",Ae,[o("div",Be,[a(W,{gutter:[16,16],align:"bottom"},{default:r(()=>[a(A,{span:8},{default:r(()=>[e[7]||(e[7]=o("label",{class:"block font-bold mb-1 text-gray-600"},"Producto:",-1)),a(B,{value:i.prd_id,"onUpdate:value":e[0]||(e[0]=u=>i.prd_id=u),"show-search":"",placeholder:"Seleccione Producto",style:{width:"100%"},options:g.value,"filter-option":d},null,8,["value","options"])]),_:1}),a(A,{span:4},{default:r(()=>[e[8]||(e[8]=o("label",{class:"block font-bold mb-1 text-gray-600"},"Tipo Historial:",-1)),a(B,{value:i.tipo,"onUpdate:value":e[1]||(e[1]=u=>i.tipo=u),style:{width:"100%"},placeholder:"Ej: vend",options:x.value,"field-names":{label:"TIPO",value:"TIPO"}},null,8,["value","options"])]),_:1}),a(A,{span:3},{default:r(()=>[e[12]||(e[12]=o("label",{class:"block font-bold mb-1 text-gray-600"},"Año:",-1)),a(B,{value:i.anio,"onUpdate:value":e[2]||(e[2]=u=>i.anio=u),style:{width:"100%"}},{default:r(()=>[a(D,{value:"2025"},{default:r(()=>e[9]||(e[9]=[v("2025")])),_:1}),a(D,{value:"2024"},{default:r(()=>e[10]||(e[10]=[v("2024")])),_:1}),a(D,{value:"2026"},{default:r(()=>e[11]||(e[11]=[v("2026")])),_:1})]),_:1},8,["value"])]),_:1}),a(A,{span:5},{default:r(()=>[e[13]||(e[13]=o("label",{class:"block font-bold mb-1 text-gray-600"},"Mes:",-1)),a(B,{value:i.mes,"onUpdate:value":e[3]||(e[3]=u=>i.mes=u),style:{width:"100%"},options:k},null,8,["value"])]),_:1}),a(A,{span:4},{default:r(()=>[a(U,{type:"primary",block:"",size:"large",onClick:S,loading:t.value},{default:r(()=>e[14]||(e[14]=[v(" AUDITAR ")])),_:1},8,["loading"])]),_:1})]),_:1})]),l.value.length>0?(C(),h("div",De,[a(j,{value:c.value,"onUpdate:value":e[4]||(e[4]=u=>c.value=u),placeholder:"Buscar por Razón Social o RUC en los resultados cargados...","allow-clear":"",size:"large"},null,8,["value"])])):$("",!0),y.value.length>0?(C(),O(V,{key:1,dataSource:y.value,columns:P,size:"middle",bordered:"",rowKey:"ruc",pagination:{pageSize:20}},{bodyCell:r(({column:u,record:m})=>[u.dataIndex==="rs"?(C(),h(F,{key:0},[o("div",ze,_(m.rs),1),o("div",Ne,"RUC: "+_(m.ruc),1)],64)):$("",!0),u.dataIndex==="cant_real"?(C(),h("div",Ee,[o("span",Ue,_(m.cant_real),1)])):$("",!0),u.dataIndex==="info"?(C(),h("div",Oe,[a(H,{title:"Análisis de Membresía",trigger:"click"},{content:r(()=>[o("div",Le,[o("div",Re,[e[18]||(e[18]=o("p",{class:"m-0 text-xs font-bold text-blue-800"},"REALIDAD:",-1)),o("p",Me,[e[15]||(e[15]=v("Usa ")),o("b",null,_(m.cant_real),1),e[16]||(e[16]=v(" vendedores."))]),o("p",Fe,[e[17]||(e[17]=v("Precio pactado: ")),o("b",null,_(b(m.precio_pactado)),1)])]),o("div",We,[e[21]||(e[21]=o("p",{class:"m-0 text-xs font-bold text-orange-800"},"CATÁLOGO OFICIAL:",-1)),o("p",je,[e[19]||(e[19]=v("Escala: ")),o("b",null,_(m.cat_fct),1),v(" (Cód: "+_(m.cat_codigo)+")",1)]),o("p",He,[e[20]||(e[20]=v("Precio Catálogo: ")),o("b",null,_(b(m.cat_precio)),1)])]),o("div",{class:X(["p-2 border-t font-bold text-center",m.diferencia<0?"text-red-600":"text-green-600"])}," Diferencia: "+_(b(m.diferencia)),3)])]),default:r(()=>[a(U,{size:"small",type:"primary",ghost:""},{default:r(()=>e[22]||(e[22]=[v("Ver Info")])),_:1})]),_:2},1024)])):$("",!0),u.dataIndex==="status"?(C(),h("div",Ve,[a(w,{color:m.status==="OK"?"green":"red"},{default:r(()=>[v(_(m.status),1)]),_:2},1032,["color"])])):$("",!0),u.dataIndex==="pago_factura_me"?(C(),h("div",qe,_(b(m.pago_factura_me)),1)):$("",!0)]),_:1},8,["dataSource"])):p.value&&!t.value?(C(),h("div",Ge,e[23]||(e[23]=[o("p",{class:"text-gray-400"},"No se encontraron resultados que coincidan con la búsqueda.",-1)]))):$("",!0)])]),_:1})}}},rt=Z(Je,[["__scopeId","data-v-ada5898f"]]);export{rt as default};
